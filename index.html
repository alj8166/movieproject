<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Spa Project</title>
    <style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f4f4f4;
    }

    header {
        background-color: #333;
        color: #fff;
        padding: 10px;
        text-align: center;
    }

    #searchSection {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin: 30px auto;
        align-items: center;
        width: fit-content;
    }

    #searchInput {
        width: 200px;
        padding: 10px;
        border-radius: 5px;
        border: 1px solid #ccc;
    }

    #searchButton {
        background-color: #333;
        color: #fff;
        border: none;
        padding: 10px 20px;
        cursor: pointer;
        border-radius: 5px;
    }

    #filter {
        padding: 10px;
        border-radius: 5px;
        border: 1px solid #ccc;
    }

    #resultsSection {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 25px;
        justify-content: center;
        padding: 20px;
    }

    #resultsSection div {
        text-align: center;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        border-radius: 5px;
        padding: 10px;
        background-color: #fff;
    }

    #resultsSection img {
        width: 175px;
        height: auto;
        object-fit: cover;
    }

    /* Styling for favorite and watch buttons */
    .list-buttons {
        display: flex;
        justify-content: space-between;
        margin-top: 10px;
    }

    .list-button {
        flex-grow: 1;
        padding: 5px;
        cursor: pointer;
        border-radius: 5px;
        border: none;
        outline: none;
    }

    .favorite-button {
        background-color: #f44336;
        color: #fff;
    }

    .watchlist-button {
        background-color: #2196F3;
        color: #fff;
    }

    /* Style for pagination buttons */
    #pagination {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin: 30px auto;
    }

    .page-button {
        background-color: #333;
        color: #fff;
        border: none;
        padding: 10px 20px;
        cursor: pointer;
        border-radius: 5px;
    }
    
    #popupContainer div {
        background: #fff;
        padding: 20px;
        max-width: 600px;
        margin: auto;
    }
    </style>
</head>
<body>
    <header>
        <h1>Movie Spa Project</h1>
    </header>
    
    <main>
        <section id="searchSection">
            <input type="text" id="searchInput" placeholder="Search movies...">
            <button id="searchButton">Search</button>
            <select id="filter">
                <option value="popularity.desc">Most Popular</option>
                <option value="original_title.asc">Alphabetical Order Ascending</option>
                <option value="original_title.desc">Alphabetical Order Descending</option>
            </select>
        </section>
        
        <section id="resultsSection">
            <!-- Results will be displayed here -->
        </section>
        
        <div id="pagination">
            <!-- Pagination buttons will be added here -->
        </div>
    </main>
    
    <div id="popupContainer" style="display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 10; padding: 50px; box-sizing: border-box; overflow: auto;">
        <!-- Movie details will be displayed here -->
    </div>

    <script>
    const searchButton = document.getElementById('searchButton');
    const searchInput = document.getElementById('searchInput');
    const resultsSection = document.getElementById('resultsSection');
    const filter = document.getElementById('filter');
    const pagination = document.getElementById('pagination');
    const popupContainer = document.getElementById('popupContainer');

    const API_KEY = '4c9db869c653c49bbdeeef0061d69462';
    const API_URL = 'https://api.themoviedb.org/3/discover/movie';
    const SEARCH_API_URL = 'https://api.themoviedb.org/3/search/movie';

    let currentPage = 1;

    // Fetch the top 20 most popular movies on page load
    fetchMovies("", "popularity.desc", currentPage);

    searchButton.addEventListener('click', () => {
        const query = searchInput.value;
        const sort = filter.value;
        currentPage = 1; // Reset current page
        fetchMovies(query, sort, currentPage);
    });

    // Create an object to store the favorite and watchlist movies
    const lists = {
        favorite: [],
        watchlist: []
    };

    function fetchMovies(query, sort, page) {
        let url;
        // If query is empty, use discover API to get most popular movies
        if (query === "") {
            url = `${API_URL}?api_key=${API_KEY}&sort_by=${sort}&page=${page}`;
        } else {
            url = `${SEARCH_API_URL}?api_key=${API_KEY}&query=${query}&page=${page}`;
        }

        fetch(url)
            .then(response => response.json())
            .then(data => {
                displayMovies(data.results, sort);
                displayPageButtons(page);
            });
    }

    function fetchMovieDetails(movieId) {
        fetch(`https://api.themoviedb.org/3/movie/${movieId}?api_key=${API_KEY}`)
            .then(response => response.json())
            .then(movie => {
                displayMovieDetails(movie);
            });
    }

    function displayMovieDetails(movie) {
        const movieDetailElement = `
            <div>
                <h2>${movie.title} (${movie.release_date.split('-')[0]})</h2>
                <p>Rating: ${movie.vote_average}</p>
                <p>${movie.overview}</p>
                <button onclick="closePopup()">Close</button>
            </div>
        `;
        popupContainer.innerHTML = movieDetailElement;
        popupContainer.style.display = 'block';
    }

    function closePopup() {
            popupContainer.style.display = 'none';
    }

    function displayMovies(movies, sort) {
        if (sort.includes("original_title")) {
            if (sort.includes("asc")) {
                movies.sort((a, b) => a.title.localeCompare(b.title));
            } else if (sort.includes("desc")) {
                movies.sort((a, b) => b.title.localeCompare(a.title));
            }
        }

        const movieElements = movies.map(movie => `
            <div>
                <img src="https://image.tmdb.org/t/p/w500/${movie.poster_path}" alt="${movie.title}">
                <h2>${movie.title}</h2>
                <div class="list-buttons">
                        <button class="list-button favorite-button" onclick="addToFavorite(${movie.id})">Add to Favorite</button>
                        <button class="list-button watchlist-button" onclick="addToWatchlist(${movie.id})">Add to Watchlist</button>
                </div>
            </div>
        `);

        resultsSection.innerHTML = movieElements.join('');
    }

    function displayPageButtons(currentPage) {
        let buttons = '';
        for (let i = 1; i <= 5; i++) {
            buttons += `<button class="page-button" onclick="fetchMovies('${searchInput.value}', '${filter.value}', ${i})">${i}</button>`;
        }
        pagination.innerHTML = buttons;
    }

    // Function to add a movie to the favorite list
    function addToFavorite(movieId) {
        const movie = findMovieById(movieId);
        if (movie && !lists.favorite.includes(movie)) {
            lists.favorite.push(movie);
            alert(`${movie.title} added to Favorite list!`);
        }
    }

    // Function to add a movie to the watchlist
    function addToWatchlist(movieId) {
        const movie = findMovieById(movieId);
        if (movie && !lists.watchlist.includes(movie)) {
            lists.watchlist.push(movie);
            alert(`${movie.title} added to Watchlist!`);
        }
    }

    // Helper function to find a movie by its ID
    function findMovieById(id) {
        return results.find(movie => movie.id === id);
    }
    </script>
</body>
</html>

